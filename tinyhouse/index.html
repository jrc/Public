<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Tiny House Heater Service</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

    <!-- Custom styles for this template -->
    <!-- link href="theme.css" rel="stylesheet" -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style TYPE="text/css">
        <!-- input[type='range'] {
        -webkit-appearance: none;
        height: 44px;
        border: 1px solid;
        border-radius: 5px;
        }

        input[type='range']::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 44px;
            height: 44px;
            border: 1px solid;
            border-radius: 5px;
        }
        -->
    </style>
</head>

<body onload="handle_onload()">
    <div class="container theme-showcase" role="main">

        <div class="page-header">
            <h1>Tiny House Heater Service</h1>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Current Temperature</h3>
            </div>
            <div class="panel-body">
                <span id="currentTemp"><strong>--</strong></span>&#x2009;&#x2103;
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Target Temperature</h3>
            </div>
            <div class="panel-body">
                <form method="POST" action="https://api.particle.io/v1/devices/54ff6e066678574936530467/setTgtTemp">
                    <p><input type="hidden" id="setTgtTempFormAccessToken" name="access_token" value="">
                        <input id="targetTempSlider" type="range" name="params" min="0" max="25" step="1" value="0"
                            oninput="document.getElementById('targetTemp').innerText = document.getElementById('targetTempSlider').value">
                        <span id="targetTempSliderLabel"><span id="targetTemp">--</span>&#x2009;&#x2103;</span>
                    </p>
                    <p><input type="submit" value="Set Temperature" class="btn btn-lg btn-default"></p>
                </form>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Current Mode</h3>
            </div>
            <div class="panel-body">
                <div id="currentMode"><strong>--</strong></div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Target Mode</h3>
            </div>
            <div class="panel-body">
                <form method="POST" action="https://api.particle.io/v1/devices/54ff6e066678574936530467/setTgtMode">
                    <p><input type="hidden" id="setTgtModeFormAccessToken" name="access_token" value="">
                        <input type="radio" id="targetModeOff" name="args" value="0"> Off
                        <BR>
                        <input type="radio" id="targetModeOn" name="args" value="1"> Heat
                        <BR>
                        <input type="radio" id="targetModeAuto" name="args" value="-1"> Auto</p>
                    <p><input type="submit" value="Set Mode" class="btn btn-lg btn-default"></input>
                    </p>
                </form>
            </div>
        </div>

        <script>
            function getQueryVariable(variable) {
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i = 0; i < vars.length; i++) {
                    var pair = vars[i].split("=");
                    if (pair[0] == variable) {
                        return pair[1];
                    }
                }
                return (false);
            }

            function load_values() {
                var xmlHttp = new XMLHttpRequest();
                var url = "https://api.particle.io/v1/devices/54ff6e066678574936530467/state?access_token=" + getQueryVariable("access_token")
                xmlHttp.open("GET", url, true);
                xmlHttp.onreadystatechange = function () {
                    if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                        var response = JSON.parse(xmlHttp.responseText);
                        var result = JSON.parse(response.result);

                        if (result["mode"] == 0) {
                            document.getElementById("currentMode").innerHTML = "Off";
                        } else if (result["mode"] == 1) {
                            document.getElementById("currentMode").innerHTML = "Heat";
                        }
                        document.getElementById("targetModeOff").checked = (result["rgtMtod"] == 0);
                        document.getElementById("targetModeOn").checked = (result["tgtMode"] == 1);
                        document.getElementById("targetModeAuto").checked = (result["tgtMode"] == -1);
                        document.getElementById("currentTemp").innerHTML = result["temp"].toFixed(1);
                        document.getElementById("targetTempSlider").value = result["tgtTemp"];
                        document.getElementById("targetTemp").innerHTML = result["tgtTemp"].toFixed(1);
                    }
                }
                xmlHttp.send(null);
            }

            function handle_onload() {
                var access_token = getQueryVariable("access_token");
                if (access_token) {
                    load_values();
                } else {
                    alert("No access token provided.");
                }
                document.getElementById("setTgtTempFormAccessToken").value = access_token;
                document.getElementById("setTgtModeFormAccessToken").value = access_token;
            }
        </script>

    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
</body>

</html>